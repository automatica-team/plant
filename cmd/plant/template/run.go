package template

import "text/template"

var Run = template.Must(
	template.New("Run").Funcs(funcs).Parse(run),
)

const run = `// CODE GENERATED BY plant; DO NOT EDIT!
package main

import (
	"log"
)

// Import plant parts
import (
	"automatica.team/plant"
	{{- range .Parts }}
	"automatica.team/{{ importpart . }}"
	{{ end }}
)

// Import plant deps
import (
	{{- range $k, $v := .Deps }}
	_ "automatica.team/{{ importdeps $k }}"
	{{ end }}
)

func main() {
	// Create a plant
	p, err := plant.New("plant.yml")
	if err != nil {
		log.Fatal(err)
	}

	// Connect to deps
	d, err := p.Connect()
	if err != nil {
		log.Fatal(err)
	}

	// Compose a new bot
	b, err := p.Compose()
	if err != nil {
		log.Fatal(err)
	}

	// Add parts to the bot
	{{- range .Parts }}
	p.Add({{ partname . }}.New(b, d))
	{{ end }}

	// Build the bot
	if err := p.Build(b); err != nil {
		log.Fatal(err)
	}

	// Start the bot
	b.Start()
}
`
